<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saklar Pintar Irone</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0f766e">
    <meta name="description" content="Panel kendali pintar untuk mengendalikan perangkat dari jarak jauh">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Saklar Pintar">
    
    <!-- PWA Links -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
    <style>
        .toggle-checkbox:checked { right: 0; border-color: #4ade80; }
        .toggle-checkbox:checked + .toggle-label { background-color: #4ade80; }
        .pulse-animation { animation: pulse 1.5s ease-in-out infinite alternate; }
        @keyframes pulse { from { opacity: 0.4; } to { opacity: 1; } }
        .toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
            text-align: center; border-radius: 5px; padding: 16px; position: fixed;
            z-index: 1; left: 50%; transform: translateX(-50%); bottom: 30px;
            opacity: 0; transition: opacity 0.5s, visibility 0.5s, bottom 0.5s;
        }
        .toast.show { visibility: visible; opacity: 1; bottom: 50px; }
        .install-prompt {
            display: none; position: fixed; top: 0; left: 0; right: 0;
            background: linear-gradient(135deg, #0f766e, #14b8a6);
            color: white; padding: 12px; text-align: center; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .install-prompt.show { display: block; }
    </style>
</head>
<body class="bg-blue-50 font-sans">
    <!-- Install Prompt -->
    <div id="install-prompt" class="install-prompt">
        <div class="flex justify-between items-center max-w-4xl mx-auto">
            <span>ðŸ“± Install aplikasi ini untuk pengalaman yang lebih baik!</span>
            <div class="space-x-2">
                <button id="install-btn" class="bg-white text-teal-700 px-4 py-1 rounded font-bold hover:bg-gray-100">
                    Install
                </button>
                <button id="dismiss-install" class="text-white hover:text-gray-200">âœ•</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="mb-6 flex justify-between items-center bg-teal-100 p-4 rounded-lg shadow-md">
            <div>
                <h1 class="text-3xl font-bold text-teal-800">Panel Kendali Pintar</h1>
                <p class="text-teal-600">Terkendali dari jauh</p>
                <div id="offline-indicator" class="hidden bg-orange-500 text-white px-2 py-1 rounded text-xs mt-2">
                    ðŸ“¡ Mode Offline - Beberapa fitur terbatas
                </div>
            </div>
            <div class="bg-white p-3 rounded-lg shadow-inner">
                <div class="flex items-center space-x-3 mb-2">
                    <div id="broker-status-light" class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <span id="broker-status-text" class="text-xs font-medium text-gray-600">Broker: Connecting...</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div id="device-status-light" class="w-3 h-3 rounded-full bg-gray-400"></div>
                    <span id="device-status-text" class="text-xs font-medium text-gray-600">Device: Unknown</span>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-blue-100 p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold text-blue-800">Lampu Teras (GPIO 12)</h3>
                <div class="flex items-center justify-between mt-4">
                    <span id="status-12" class="text-gray-500 font-medium text-lg">...</span>
                    <div class="relative inline-block w-14 align-middle select-none">
                        <input type="checkbox" id="toggle-12" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="toggle-12" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
            </div>
            <div class="bg-purple-100 p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold text-purple-800">Pompa Air (GPIO 13)</h3>
                <div class="flex items-center justify-between mt-4">
                    <span id="status-13" class="text-gray-500 font-medium text-lg">...</span>
                    <div class="relative inline-block w-14 align-middle select-none">
                        <input type="checkbox" id="toggle-13" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="toggle-13" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
            </div>
            <div class="bg-orange-100 p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold text-orange-800">Lampu Taman (GPIO 14)</h3>
                <div class="flex items-center justify-between mt-4">
                    <span id="status-14" class="text-gray-500 font-medium text-lg">...</span>
                        <div class="relative inline-block w-14 align-middle select-none">
                        <input type="checkbox" id="toggle-14" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="toggle-14" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-lime-100 p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4 border-b border-lime-300 pb-2 text-lime-800">Pengaturan Jadwal</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-medium mb-3 text-lime-700">Buat Jadwal Baru</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="sched-gpio" class="block text-sm font-medium text-gray-700">Perangkat (GPIO)</label>
                            <select id="sched-gpio" class="mt-1 block w-full pl-3 pr-10 py-2 border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500">
                                <option value="12">Lampu Teras (12)</option>
                                <option value="13">Pompa Air (13)</option>
                                <option value="14">Lampu Taman (14)</option>
                            </select>
                        </div>
                        <div>
                            <label for="sched-time" class="block text-sm font-medium text-gray-700">Waktu (HH:MM)</label>
                            <input type="time" id="sched-time" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500">
                        </div>
                        <div>
                            <label for="sched-state" class="block text-sm font-medium text-gray-700">Aksi</label>
                            <select id="sched-state" class="mt-1 block w-full pl-3 pr-10 py-2 border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500">
                                <option value="1">ON</option>
                                <option value="0">OFF</option>
                            </select>
                        </div>
                        <button id="addSchedBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-lg transform hover:scale-105 transition-transform">
                            Tambah ke Daftar
                        </button>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between items-center mb-3">
                         <h3 class="text-lg font-medium text-lime-700">Daftar Jadwal Lokal</h3>
                         <div class="flex items-center space-x-2">
                             <button id="refreshSchedBtn" title="Muat ulang jadwal dari perangkat" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-md text-sm shadow-md">
                                 Muat Ulang
                             </button>
                             <button id="sendSchedBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-md text-sm shadow-md">
                                 Kirim & Sinkronkan
                             </button>
                         </div>
                    </div>
                    <div id="schedule-list" class="bg-white p-3 rounded-md h-64 overflow-y-auto border border-lime-200">
                        <p class="text-gray-400 text-center mt-4">Menunggu sinkronisasi dari perangkat...</p>
                    </div>
                </div>
            </div>
       </div>
    </div>
    <div id="toast" class="toast">Pesan Notifikasi</div>

    <script src="app.js"></script>
</body>
</html>